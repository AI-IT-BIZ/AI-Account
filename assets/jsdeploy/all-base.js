
Ext.define('BASE.PreviewWindow',{extend:'Ext.window.Window',title:'รายงาน',closeAction:'hide',height:700,width:830,minHeight:600,minWidth:830,layout:'border',border:false,resizable:true,modal:true,buttonAlign:'center',iframe_id:null,enableCopies:true,constructor:function(config){var _this=this;this.iframe_id='preview_frame_'+Ext.id();if(this.enableCopies){this.openDialog=function(form_values){if(form_values&&!Ext.isEmpty(form_values)){_this.dialogParams=form_values;_this.show(false,function(){var frameUrl=_this.getFrameUrl(form_values,_this.copies.getValue());_this.setFrameSrc(frameUrl);_this.showFrameLoad();_this.checkFrameReady(function(){_this.hideFrameLoad();});});}};}else{this.openDialog=function(url){if(url){_this.show(false,function(){_this.setFrameSrc(url);_this.showFrameLoad();_this.checkFrameReady(function(){_this.hideFrameLoad();});});}};}
return this.callParent(arguments);},initComponent:function(){var _this=this;this.items=[new Ext.Panel({region:'center',border:false,items:[{xtype:'component',id:this.iframe_id,autoEl:{tag:'iframe',src:'about:blank',frameBorder:0,width:'100%',height:'100%',style:{overflow:'auto'}}}]})];if(this.enableCopies){this.copies=new Ext.form.NumberField({name:'copies',allowBlank:false,allowDecimals:false,allowNegative:false,fieldLabel:'Copies',labelAlign:'right',labelWidth:60,value:1,minValue:1,maxValue:500,width:130});this.btnPrint=Ext.create('Ext.Button',{text:'Print',handler:function(){var id=_this.iframe_id;var iframe=document.frames?document.frames[id]:document.getElementById(id);var ifWin=iframe.contentWindow||iframe;iframe.focus();ifWin.do_print();}});this.buttons=[this.copies,this.btnPrint,{text:'Cancel',handler:function(){_this.hide();}}];}
this.on('hide',function(){_this.setFrameSrc('about:blank');if(this.enableCopies)
this.copies.setValue(1);});if(this.enableCopies){this.copies.on('change',function(copies,newVal,oldVal){_this.showFrameLoad();Ext.get(_this.iframe_id).set({src:_this.getFrameUrl(_this.dialogParams,newVal)});_this.checkFrameReady(function(){_this.hideFrameLoad();});});}
return this.callParent(arguments);},dialogParams:null,getFrameUrl:null,setFrameSrc:function(url){Ext.get(this.iframe_id).set({src:url});},checkFrameReady:function(cb){document.getElementById(this.iframe_id).onload=cb;},showFrameLoad:function(){Ext.MessageBox.show({msg:'Populating preview...',progressText:'Loading...',width:300,wait:true,waitConfig:{interval:200},animateTarget:this});},hideFrameLoad:function(){Ext.MessageBox.hide();}});;Ext.define('BASE.form.field.PercentOrNumber',{extend:'Ext.form.field.Text',constructor:function(config){var _this=this;this.validator=function(v){if(!Ext.isEmpty(v)){var regEx=/^([0-9]*)(\.[1-9]*)?$|^([0-9]|[1-9][0-9]|100)(\.[1-9]*)?(%)$/gi;if(regEx.test(v))
return true;else
return'Value can be only numbers or percent';}else
return true;};return this.callParent(arguments);},calculateValue:function(totalValue){var v=this.getValue(),regEx=/%$/gi;if(regEx.test(v)){var percVal=parseFloat(v.replace(regEx,''));return totalValue*percVal/100;}else{return v;}}});